<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>90-Day Exercise Tracker - Enhanced</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  
  <style>
    .google-btn {
      background: white;
      border: 1px solid #dadce0;
      border-radius: 4px;
      color: #3c4043;
      font-size: 14px;
      font-weight: 500;
      padding: 0;
      transition: background-color 0.218s, border-color 0.218s;
      cursor: pointer;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    .google-btn:hover {
      background-color: #f7f8f8;
      border-color: #d2d3d4;
    }
	
	@keyframes prPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}
.pr-animate {
  animation: prPulse 0.5s ease-in-out 3;
}
@keyframes confetti {
  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  animation: confetti 3s linear forwards;
}
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const firebaseConfig = {
      apiKey: "AIzaSyDflVWpWRaM79otPlFdgY9Jj2_TT8coP8c",
      authDomain: "workout-tracker-cf45f.firebaseapp.com",
      projectId: "workout-tracker-cf45f",
      storageBucket: "workout-tracker-cf45f.appspot.com",
      messagingSenderId: "557876111419",
      appId: "1:557876111419:web:621155c84179128c89541e"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const auth = firebase.auth();
const Award = (p) => <Icon {...p}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></Icon>;
const TrendingDown = (p) => <Icon {...p}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></Icon>;
const Minus2 = (p) => <Icon {...p}><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
    const Icon = ({ children, className = "w-5 h-5" }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{children}</svg>
    );
    
    const Calendar = (p) => <Icon {...p}><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></Icon>;
    const TrendingUp = (p) => <Icon {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></Icon>;
    const Dumbbell = (p) => <Icon {...p} className={p.className || "w-5 h-5"}><path d="M14.4 14.4L9.6 9.6M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"/></Icon>;
    const Clock = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>;
    const Play = (p) => <Icon {...p} className="w-4 h-4"><polygon points="5 3 19 12 5 21 5 3"/></Icon>;
    const RotateCcw = (p) => <Icon {...p}><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></Icon>;
    const Save = (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
    const Trash2 = (p) => <Icon {...p} className="w-4 h-4"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>;
    const Edit2 = (p) => <Icon {...p} className="w-4 h-4"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></Icon>;
    const Plus = (p) => <Icon {...p} className="w-4 h-4"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
    const Minus = (p) => <Icon {...p} className="w-4 h-4"><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
    const LogOut = (p) => <Icon {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></Icon>;
    const BarChart = (p) => <Icon {...p}><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></Icon>;

    const EXERCISES = {
      bicepTricep: [
        { name: 'Barbell Curl', sets: 3, reps: 12, instructions: 'Stand with feet shoulder-width, grip barbell at shoulder-width, curl slowly keeping elbows tucked, pause at top, lower with control.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=171' },
        { name: 'Close-Grip Bench Press', sets: 4, reps: 12, instructions: 'Lie on bench, grip barbell narrower than shoulder-width, lower to mid-chest, press up powerfully, keep elbows close to body.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=614' },
        { name: 'Weighted Chin-Up (Supinated Grip)', sets: 3, reps: 12, instructions: 'Use supinated grip, hang with full stretch, pull up until chin over bar, lower slowly to avoid swinging.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=330' },
        { name: 'Dumbbell Preacher Curl', sets: 4, reps: 12, instructions: 'Sit at preacher bench, arm fully extended, curl dumbbell up, squeeze at top, lower slowly to full stretch.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=265' },
        { name: 'Overhead Dumbbell Triceps Extension', sets: 3, reps: 12, instructions: 'Hold dumbbell overhead with both hands, lower behind head keeping elbows high, extend arms fully, avoid flaring elbows.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=524' },
        { name: 'EZ Bar Reverse Curl', sets: 3, reps: 12, instructions: 'Grip EZ bar overhand, curl up keeping wrists straight, pause at top, lower slowly to target brachioradialis.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=489' }
      ],
      chest: [
        { name: 'Barbell Bench Press', sets: 4, reps: 12, instructions: 'Lie flat, grip barbell slightly wider than shoulders, lower to mid-chest, press up, keep scapulae retracted.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=180' },
        { name: 'Incline Dumbbell Press', sets: 3, reps: 12, instructions: 'Set bench to 30-45¬∞, hold dumbbells, press up while keeping slight arch in back, lower to chest level.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=300' },
        { name: 'Weighted Dips', sets: 3, reps: 12, instructions: 'Lean slightly forward, lower until shoulders below elbows, push up, keep core tight to target chest.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=420' },
        { name: 'Cable Crossover', sets: 3, reps: 12, instructions: 'Set cables above shoulders, pull handles down and across body, squeeze chest at peak, return with stretch.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=510' }
      ],
      back: [
        { name: 'Deadlift', sets: 4, reps: 12, instructions: 'Feet hip-width, grip barbell outside knees, keep back flat, pull up, thrust hips forward, lower with control.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=120' },
        { name: 'Weighted Pull-Up', sets: 3, reps: 12, instructions: 'Use overhand grip, hang fully, pull up until chin over bar, lower slowly to maximize lat activation.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=330' },
        { name: 'Barbell Row', sets: 3, reps: 12, instructions: 'Hinge at hips, grip barbell, pull to lower ribs, keep back parallel to ground, avoid jerking.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=240' },
        { name: 'Seated Cable Row', sets: 3, reps: 12, instructions: 'Sit upright, pull cable handle to mid-torso, retract scapulae, keep elbows close, return with stretch.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=450' }
      ],
      shoulders: [
        { name: 'Overhead Barbell Press', sets: 4, reps: 12, instructions: 'Stand or sit, grip barbell at shoulder-width, press overhead, lock out arms, lower to collarbone level.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=150' },
        { name: 'Dumbbell Lateral Raise', sets: 4, reps: 12, instructions: 'Stand with dumbbells at sides, raise to shoulder height, slight bend in elbows, lower with control.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=270' },
        { name: 'Rear Delt Fly (Dumbbell)', sets: 3, reps: 12, instructions: 'Bend forward, hold dumbbells, raise arms outward, squeeze rear delts, keep movement controlled.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=390' },
        { name: 'Face Pull', sets: 3, reps: 12, instructions: 'Set cable at face height, pull rope to ears, elbows high, squeeze rear delts, avoid shrugging.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=510' }
      ],
      legs: [
        { name: 'Barbell Squat', sets: 4, reps: 12, instructions: 'Bar on upper traps, feet shoulder-width, squat to knee depth, keep chest up, drive through heels.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=180' },
        { name: 'Romanian Deadlift', sets: 3, reps: 12, instructions: 'Hold barbell, hinge at hips, lower to mid-shin, keep back flat, pull up using hamstrings.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=300' },
        { name: 'Bulgarian Split Squat', sets: 3, reps: 12, instructions: 'Rear foot elevated, front foot forward, lower until front thigh parallel, push through front heel.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=420' },
        { name: 'Leg Press', sets: 3, reps: 12, instructions: 'Feet shoulder-width on platform, lower until knees at 90¬∞, push through heels, avoid locking knees.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=540' }
      ]
    };

    const DEFAULT = {
      bicepTricep: { name: 'Bicep & Tricep', exercises: [EXERCISES.bicepTricep[0], EXERCISES.bicepTricep[1], EXERCISES.bicepTricep[3]] },
      chest: { name: 'Chest', exercises: [EXERCISES.chest[0], EXERCISES.chest[1]] },
      back: { name: 'Back', exercises: [EXERCISES.back[0], EXERCISES.back[1]] },
      shoulders: { name: 'Shoulders', exercises: [EXERCISES.shoulders[0], EXERCISES.shoulders[1]] },
      legs: { name: 'Legs', exercises: [EXERCISES.legs[0], EXERCISES.legs[1]] }
    };

    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [templates, setTemplates] = useState(DEFAULT);
      const [workouts, setWorkouts] = useState([]);
      const [view, setView] = useState('home');
      const [editing, setEditing] = useState(null);
      const [workout, setWorkout] = useState(null);
      const [editingWorkout, setEditingWorkout] = useState(null);
      const [showTimeEdit, setShowTimeEdit] = useState(false);
      const [resumingWorkout, setResumingWorkout] = useState(false);
      const [timer, setTimer] = useState({ time: 90, left: 0, active: false });
      const [showNew, setShowNew] = useState(false);
      const [newEx, setNewEx] = useState({ name: '', sets: 3, reps: 10, instructions: '', videoUrl: '' });
      const [editEx, setEditEx] = useState(null);
      const [video, setVideo] = useState(null);
      const [videoOrientation, setVideoOrientation] = useState('landscape');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [authMode, setAuthMode] = useState('login');
      const [newTemplate, setNewTemplate] = useState({ name: '', exercises: [] });
	  const [personalRecords, setPersonalRecords] = useState({});
const [showPRModal, setShowPRModal] = useState(null);
      const [showAddExercise, setShowAddExercise] = useState(false);
      const [editingExerciseInWorkout, setEditingExerciseInWorkout] = useState(null);

      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged((user) => {
          setUser(user);
          setLoading(false);
          if (user) loadData(user.uid);
        });
        return unsubscribe;
      }, []);

      const loadData = async (uid) => {
        try {
          const templatesDoc = await db.collection('users').doc(uid).collection('data').doc('templates').get();
          if (templatesDoc.exists) {
            setTemplates(templatesDoc.data().templates || DEFAULT);
          }

          const ninetyDaysAgo = new Date();
          ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
          
          const workoutsSnapshot = await db.collection('users').doc(uid).collection('workouts')
            .where('start', '>=', ninetyDaysAgo.toISOString())
            .orderBy('start', 'desc')
            .limit(100)
            .get();
          
          const workoutsData = [];
          workoutsSnapshot.forEach(doc => {
            workoutsData.push({ id: doc.id, ...doc.data() });
          });
          setWorkouts(workoutsData);

          // Load Personal Records
          const prsDoc = await db.collection('users').doc(uid).collection('data').doc('prs').get();
          if (prsDoc.exists) {
            setPersonalRecords(prsDoc.data().records || {});
          }
        } catch (error) {
          console.error('Error loading:', error);
        }
      };
const savePRs = async (newPRs) => {
  if (!user) return;
  try {
    await db.collection('users').doc(user.uid).collection('data').doc('prs').set({
      records: newPRs,
      updated: new Date().toISOString()
    });
    setPersonalRecords(newPRs);
  } catch (error) {
    console.error('Error saving PRs:', error);
  }
};

const checkAndUpdatePR = (exerciseName, weight, reps) => {
  const currentPR = personalRecords[exerciseName];
  const newWeight = parseFloat(weight);
  const newReps = parseInt(reps);
  
  if (!newWeight || !newReps) return false;

  // Estimate 1RM: weight * (1 + reps/30)
  const estimated1RM = newWeight * (1 + newReps / 30);

  if (!currentPR || estimated1RM > currentPR.estimated1RM) {
    const newPRs = {
      ...personalRecords,
      [exerciseName]: {
        weight: newWeight,
        reps: newReps,
        estimated1RM: estimated1RM,
        date: new Date().toISOString()
      }
    };
    savePRs(newPRs);
    
    // Show celebration modal
    setShowPRModal({ 
      exercise: exerciseName, 
      weight: newWeight, 
      reps: newReps, 
      estimated1RM: estimated1RM.toFixed(1),
      isNew: !currentPR,
      previous: currentPR ? currentPR.estimated1RM.toFixed(1) : null
    });
    
    // Create confetti effect
    createConfetti();
    
    return true;
  }
  return false;
};

const createConfetti = () => {
  const colors = ['#FFD700', '#FFA500', '#FF6347', '#FF1493', '#00CED1'];
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = Math.random() * 0.5 + 's';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 3000);
    }, i * 30);
  }
};

const getLastWorkouts = (exerciseName, count = 5) => {
  const history = [];
  for (let w of workouts) {
    if (!w.completed) continue; // Only completed workouts
    const ex = w.exercises?.find(e => e.name === exerciseName);
    if (ex && ex.weights && ex.weights.some(w => w)) {
      history.push({
        date: w.start,
        exercise: ex
      });
      if (history.length >= count) break;
    }
  }
  return history;
};

const getTrendForExercise = (exerciseName) => {
  const history = getLastWorkouts(exerciseName, 3);
  if (history.length < 2) return 'neutral';

  const getMaxWeight = (ex) => Math.max(...ex.weights.map(w => parseFloat(w) || 0));
  const lastMax = getMaxWeight(history[0].exercise);
  const prevMax = getMaxWeight(history[1].exercise);

  if (lastMax > prevMax * 1.02) return 'up';     // 2% increase
  if (lastMax < prevMax * 0.98) return 'down';   // 2% decrease
  return 'neutral';
};
      const saveTemplates = async (newTemplates) => {
        if (!user) return;
        try {
          await db.collection('users').doc(user.uid).collection('data').doc('templates').set({
            templates: newTemplates,
            updated: new Date().toISOString()
          });
          setTemplates(newTemplates);
        } catch (error) {
          console.error('Error saving:', error);
          alert('Error saving. Please try again.');
        }
      };

      const deleteTemplate = async (templateKey) => {
        if (!user || !confirm('Delete this template?')) return;
        try {
          const newTemplates = { ...templates };
          delete newTemplates[templateKey];
          await saveTemplates(newTemplates);
        } catch (error) {
          console.error('Error deleting:', error);
          alert('Error deleting template.');
        }
      };

      const getAllExercises = () => {
        const allExercises = [];
        Object.values(EXERCISES).forEach(categoryExercises => {
          allExercises.push(...categoryExercises);
        });
        return allExercises;
      };

     const saveWorkoutToDb = async (workoutData) => {
  if (!user) return;
  try {
    await db.collection('users').doc(user.uid).collection('workouts').add({
      ...workoutData,
      created: new Date().toISOString()
    });
    
    // Check for PRs
    workoutData.exercises.forEach(ex => {
      ex.weights?.forEach((weight, idx) => {
        if (weight && ex.done[idx] && ex.reps2[idx]) {
          checkAndUpdatePR(ex.name, weight, ex.reps2[idx]);
        }
      });
    });
    
    loadData(user.uid);
  } catch (error) {
    console.error('Error saving workout:', error);
    alert('Error saving workout.');
  }
};

      const saveWorkoutProgress = async (workoutData, workoutId = null) => {
        if (!user) return;
        try {
          if (workoutId) {
            await db.collection('users').doc(user.uid).collection('workouts').doc(workoutId).update({
              ...workoutData,
              updated: new Date().toISOString()
            });
          } else {
            const docRef = await db.collection('users').doc(user.uid).collection('workouts').add({
              ...workoutData,
              inProgress: true,
              created: new Date().toISOString()
            });
            return docRef.id;
          }
          loadData(user.uid);
        } catch (error) {
          console.error('Error saving progress:', error);
        }
      };

      const updateWorkoutInDb = async (workoutId, workoutData) => {
        if (!user) return;
        try {
          await db.collection('users').doc(user.uid).collection('workouts').doc(workoutId).update({
            ...workoutData,
            updated: new Date().toISOString()
          });
          loadData(user.uid);
        } catch (error) {
          console.error('Error updating workout:', error);
          alert('Error updating workout.');
        }
      };

      const deleteWorkout = async (workoutId) => {
        if (!user || !confirm('Delete this workout?')) return;
        try {
          await db.collection('users').doc(user.uid).collection('workouts').doc(workoutId).delete();
          setWorkouts(workouts.filter(w => w.id !== workoutId));
        } catch (error) {
          console.error('Error deleting:', error);
        }
      };

      const resumeWorkout = (workoutData) => {
        setWorkout({
          name: workoutData.name,
          start: workoutData.start,
          resumedFrom: workoutData.id,
          exercises: workoutData.exercises.map(ex => ({
            ...ex,
            done: ex.done || Array(ex.sets).fill(false),
            weights: ex.weights || Array(ex.sets).fill(''),
            reps2: ex.reps2 || Array(ex.sets).fill('')
          }))
        });
        setResumingWorkout(true);
        setView('workout');
      };

      const getLastWorkout = (exerciseName) => {
        // Only look for COMPLETED workouts
        for (let w of workouts) {
          if (!w.completed) continue; // Skip in-progress workouts
          const ex = w.exercises?.find(e => e.name === exerciseName);
          if (ex && ex.weights && ex.weights.some(w => w)) {
            return ex;
          }
        }
        return null;
      };

      const addSetToExercise = (exerciseIndex) => {
        const w = { ...workout };
        const ex = w.exercises[exerciseIndex];
        ex.sets = ex.sets + 1;
        ex.done.push(false);
        ex.weights.push('');
        ex.reps2.push('');
        setWorkout(w);
      };

      const removeSetFromExercise = (exerciseIndex) => {
        const w = { ...workout };
        const ex = w.exercises[exerciseIndex];
        if (ex.sets <= 1) {
          alert('Exercise must have at least 1 set');
          return;
        }
        ex.sets = ex.sets - 1;
        ex.done.pop();
        ex.weights.pop();
        ex.reps2.pop();
        setWorkout(w);
      };

      const addExerciseToWorkout = (exercise) => {
        const w = { ...workout };
        w.exercises.push({
          ...exercise,
          done: Array(exercise.sets).fill(false),
          weights: Array(exercise.sets).fill(''),
          reps2: Array(exercise.sets).fill('')
        });
        setWorkout(w);
        setShowAddExercise(false);
      };

      const removeExerciseFromWorkout = (exerciseIndex) => {
        if (!confirm('Remove this exercise from the workout?')) return;
        const w = { ...workout };
        w.exercises.splice(exerciseIndex, 1);
        setWorkout(w);
      };

      const handleAuth = async (e) => {
        e.preventDefault();
        try {
          if (authMode === 'login') {
            await auth.signInWithEmailAndPassword(email, password);
          } else {
            await auth.createUserWithEmailAndPassword(email, password);
          }
          setEmail('');
          setPassword('');
        } catch (error) {
          alert(error.message);
        }
      };

      const handleGoogleSignIn = async () => {
        try {
          const provider = new firebase.auth.GoogleAuthProvider();
          await auth.signInWithPopup(provider);
        } catch (error) {
          console.error('Google sign-in error:', error);
          alert(error.message);
        }
      };

      const handleLogout = async () => {
        await auth.signOut();
        setTemplates(DEFAULT);
        setWorkouts([]);
      };

      useEffect(() => {
        if (!timer.active || timer.left <= 0) return;
        const id = setInterval(() => {
          setTimer(t => {
            if (t.left <= 1) {
              playSound('complete');
              return { ...t, left: 0, active: false };
            }
            return { ...t, left: t.left - 1 };
          });
        }, 1000);
        return () => clearInterval(id);
      }, [timer.active, timer.left]);

      const playSound = (type = 'complete') => {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const now = ctx.currentTime;
          
          if (type === 'complete') {
            for (let i = 0; i < 5; i++) {
              const osc = ctx.createOscillator();
              const gain = ctx.createGain();
              osc.connect(gain);
              gain.connect(ctx.destination);
              osc.frequency.value = i % 2 === 0 ? 880 : 1046;
              osc.type = 'square';
              const start = now + (i * 0.2);
              gain.gain.setValueAtTime(0.3, start);
              gain.gain.exponentialRampToValueAtTime(0.01, start + 0.15);
              osc.start(start);
              osc.stop(start + 0.15);
            }
            setTimeout(() => alert('‚è∞ REST DONE!'), 1000);
          } else if (type === 'ding') {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = 800;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.6, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
            osc.start(now);
            osc.stop(now + 0.4);
            
            const osc2 = ctx.createOscillator();
            const gain2 = ctx.createGain();
            osc2.connect(gain2);
            gain2.connect(ctx.destination);
            osc2.frequency.value = 1200;
            osc2.type = 'sine';
            gain2.gain.setValueAtTime(0.4, now);
            gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.35);
            osc2.start(now);
            osc2.stop(now + 0.35);
          }
        } catch (e) {
          console.error('Audio error:', e);
        }
      };

      const getVideoId = (url) => {
        if (!url) return null;
        url = String(url).trim().replace('https://', '').replace('http://', '');

        if (url.includes('youtube.com/embed/')) {
          const [path, query] = url.split('?');
          const id = path.split('embed/')[1].split('/')[0].split('&')[0];
          const params = query ? `?${query}` : '';
          return { type: 'youtube', id, params };
        }

        if (url.includes('youtube.com/watch') && url.includes('v=')) {
          const id = url.split('v=')[1].split('&')[0].split('#')[0];
          return { type: 'youtube', id, params: '' };
        }

        if (url.includes('youtu.be/')) {
          const id = url.split('youtu.be/')[1].split('?')[0].split('&')[0];
          return { type: 'youtube', id, params: '' };
        }

        if (url.includes('vimeo.com')) {
          const match = url.match(/vimeo\.com\/(\d+)/);
          if (match) return { type: 'vimeo', id: match[1], params: '' };
        }

        if (url.includes('drive.google.com')) {
          const match = url.match(/\/d\/([^\/]+)/);
          if (match) return { type: 'drive', id: match[1], params: '' };
        }

        return null;
      };
// PR Modal
if (showPRModal) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
      <div className="bg-gradient-to-br from-yellow-400 via-orange-500 to-red-500 rounded-lg p-8 max-w-md w-full text-center pr-animate">
        <Award className="w-24 h-24 mx-auto mb-4 text-white animate-bounce" />
        <h2 className="text-4xl font-bold text-white mb-2">
          üèÜ {showPRModal.isNew ? 'NEW' : 'IMPROVED'} PERSONAL RECORD! üèÜ
        </h2>
        <div className="bg-white bg-opacity-20 rounded-lg p-6 mb-4">
          <div className="text-white text-2xl font-bold mb-3">{showPRModal.exercise}</div>
          <div className="text-white text-3xl font-black mb-2">
            {showPRModal.weight} lbs √ó {showPRModal.reps} reps
          </div>
          <div className="text-white text-xl font-semibold mb-3">
            Estimated 1RM: {showPRModal.estimated1RM} lbs
          </div>
          {showPRModal.previous && (
            <div className="text-white text-sm opacity-90">
              Previous: {showPRModal.previous} lbs (+{(showPRModal.estimated1RM - showPRModal.previous).toFixed(1)} lbs)
            </div>
          )}
        </div>
        <button 
          onClick={() => setShowPRModal(null)} 
          className="bg-white text-orange-600 px-8 py-4 rounded-lg font-bold text-lg hover:bg-gray-100 transform hover:scale-105 transition"
        >
          HELL YEAH! üí™
        </button>
      </div>
    </div>
  );
}
      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
            <div className="text-white text-2xl">Loading...</div>
          </div>
        );
      }

      if (!user) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center p-4">
            <div className="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
              <div className="flex items-center justify-center gap-3 mb-6">
                <Dumbbell className="w-12 h-12 text-indigo-600" />
                <h1 className="text-3xl font-bold text-gray-800">Workout Tracker</h1>
              </div>
              
              <form onSubmit={handleAuth} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} required className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="your@email.com" />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                  <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} required minLength="6" className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                </div>
                
                <button type="submit" className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-semibold">
                  {authMode === 'login' ? 'Sign In' : 'Sign Up'}
                </button>
              </form>
              
              <div className="mt-4">
                <div className="relative">
                  <div className="absolute inset-0 flex items-center">
                    <div className="w-full border-t border-gray-300"></div>
                  </div>
                  <div className="relative flex justify-center text-sm">
                    <span className="px-2 bg-white text-gray-500">Or continue with</span>
                  </div>
                </div>
                
                <button onClick={handleGoogleSignIn} className="w-full mt-4 google-btn">
                  <svg className="w-5 h-5" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                  </svg>
                  <span>Sign in with Google</span>
                </button>
              </div>
              
              <div className="mt-4 text-center">
                <button onClick={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')} className="text-indigo-600 hover:text-indigo-800 text-sm">
                  {authMode === 'login' ? 'Need an account? Sign up' : 'Have an account? Sign in'}
                </button>
              </div>
              
              <div className="mt-6 text-xs text-gray-500 text-center space-y-1">
                <p>‚úÖ Sync across all devices</p>
                <p>‚úÖ Track last workout data</p>
                <p>‚úÖ Week-by-week progress</p>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'progress') {
        const getWeeklyData = () => {
          const weeks = {};
          workouts.forEach(w => {
            if (!w.completed) return; // Only include completed workouts
            const date = new Date(w.start);
            const weekStart = new Date(date);
            weekStart.setDate(date.getDate() - date.getDay());
            const weekKey = weekStart.toISOString().split('T')[0];
            
            if (!weeks[weekKey]) {
              weeks[weekKey] = { workouts: 0, sets: 0, exercises: {} };
            }
            weeks[weekKey].workouts++;
            w.exercises.forEach(ex => {
              const completedSets = ex.done?.filter(Boolean).length || 0;
              weeks[weekKey].sets += completedSets;
              
              if (!weeks[weekKey].exercises[ex.name]) {
                weeks[weekKey].exercises[ex.name] = [];
              }
              
              ex.weights?.forEach((weight, idx) => {
                if (weight && ex.done[idx]) {
                  weeks[weekKey].exercises[ex.name].push({
                    weight: parseFloat(weight),
                    reps: parseInt(ex.reps2?.[idx] || ex.reps)
                  });
                }
              });
            });
          });
          
          return Object.entries(weeks).sort((a, b) => b[0].localeCompare(a[0])).slice(0, 12);
        };

        const weeklyData = getWeeklyData();

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
            <div className="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-3">
                  <BarChart className="w-8 h-8 text-indigo-600" />
                  Progress Dashboard
                </h1>
                <button onClick={() => setView('home')} className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                  Back
                </button>
              </div>
{Object.keys(personalRecords).length > 0 && (
          <div className="bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 rounded-lg p-6 mb-6">
            <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
              <Award className="w-6 h-6" />
              Personal Records üèÜ
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
              {Object.entries(personalRecords).map(([exercise, pr]) => (
                <div key={exercise} className="bg-white bg-opacity-20 rounded-lg p-4 hover:bg-opacity-30 transition">
                  <div className="text-white font-bold text-sm mb-2">{exercise}</div>
                  <div className="text-white text-2xl font-black mb-1">
                    {pr.weight} lbs √ó {pr.reps}
                  </div>
                  <div className="text-white text-xs opacity-90 mb-1">
                    Est. 1RM: {pr.estimated1RM.toFixed(1)} lbs
                  </div>
                  <div className="text-white text-xs opacity-75">
                    {new Date(pr.date).toLocaleDateString()}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
              <div className="space-y-6">
                {weeklyData.map(([weekKey, data]) => {
                  const weekDate = new Date(weekKey);
                  const weekEnd = new Date(weekDate);
                  weekEnd.setDate(weekDate.getDate() + 6);
                  
                  return (
                    <div key={weekKey} className="border-2 border-indigo-200 rounded-lg p-4 bg-indigo-50">
                      <div className="flex justify-between items-center mb-3">
                        <h3 className="text-lg font-bold text-gray-800">
                          Week of {weekDate.toLocaleDateString()} - {weekEnd.toLocaleDateString()}
                        </h3>
                        <div className="flex gap-4 text-sm">
                          <span className="bg-indigo-600 text-white px-3 py-1 rounded">{data.workouts} workouts</span>
                          <span className="bg-purple-600 text-white px-3 py-1 rounded">{data.sets} sets</span>
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        {Object.entries(data.exercises).map(([exName, sets]) => {
                          const maxWeight = Math.max(...sets.map(s => s.weight));
                          const totalReps = sets.reduce((sum, s) => sum + s.reps, 0);
                          const avgWeight = (sets.reduce((sum, s) => sum + s.weight, 0) / sets.length).toFixed(1);
                          
                          return (
                            <div key={exName} className="bg-white rounded p-3 border border-gray-200">
                              <div className="font-semibold text-sm text-gray-800 mb-1">{exName}</div>
                              <div className="text-xs text-gray-600 space-y-1">
                                <div>Max: <span className="font-bold text-indigo-600">{maxWeight} lbs</span></div>
                                <div>Avg: <span className="font-bold">{avgWeight} lbs</span></div>
                                <div>Total Reps: <span className="font-bold">{totalReps}</span></div>
                                <div>Sets: <span className="font-bold">{sets.length}</span></div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  );
                })}
              </div>

              {weeklyData.length === 0 && (
                <div className="text-center py-12 text-gray-500">
                  <BarChart className="w-16 h-16 mx-auto mb-3 opacity-50" />
                  <p>No completed workouts yet. Finish workouts to see progress!</p>
                </div>
              )}
            </div>
          </div>
        );
      }

      if (editingWorkout) {
        const workoutDuration = () => {
          const start = new Date(editingWorkout.start);
          const end = editingWorkout.end ? new Date(editingWorkout.end) : new Date();
          const diffMs = end - start;
          const diffMins = Math.floor(diffMs / 60000);
          return `${diffMins} minutes`;
        };

        return (
          <div className="min-h-screen bg-slate-900 p-4">
            <div className="max-w-4xl mx-auto bg-slate-800 rounded-lg p-6">
              <div className="flex justify-between mb-6">
                <div>
                  <h1 className="text-2xl font-bold text-white">Edit Workout: {editingWorkout.name}</h1>
                  <div className="text-sm text-gray-400 mt-1">Duration: {workoutDuration()}</div>
                </div>
                <button onClick={() => setEditingWorkout(null)} className="text-gray-400 text-2xl">‚úï</button>
              </div>

              <div className="bg-slate-700 rounded-lg p-4 mb-4">
                <h3 className="text-white font-semibold mb-3">Workout Times</h3>
                <div className="space-y-3">
                  <div>
                    <label className="text-gray-300 text-sm block mb-1">Start Time</label>
                    <input
                      type="datetime-local"
                      value={new Date(editingWorkout.start).toISOString().slice(0, 16)}
                      onChange={(e) => setEditingWorkout({ ...editingWorkout, start: new Date(e.target.value).toISOString() })}
                      className="w-full px-3 py-2 bg-slate-600 text-white rounded"
                    />
                  </div>
                  <div>
                    <label className="text-gray-300 text-sm block mb-1">End Time</label>
                    <input
                      type="datetime-local"
                      value={editingWorkout.end ? new Date(editingWorkout.end).toISOString().slice(0, 16) : ''}
                      onChange={(e) => setEditingWorkout({ ...editingWorkout, end: new Date(e.target.value).toISOString() })}
                      className="w-full px-3 py-2 bg-slate-600 text-white rounded"
                    />
                  </div>
                </div>
              </div>

              {editingWorkout.exercises.map((ex, i) => (
                <div key={i} className="bg-slate-700 rounded-lg p-4 mb-3">
                  <h3 className="text-white font-semibold mb-3">{ex.name}</h3>
                  {Array.from({ length: ex.sets }).map((_, j) => (
                    <div key={j} className="flex items-center gap-2 mb-2 flex-wrap">
                      <input
                        type="checkbox"
                        checked={ex.done?.[j] || false}
                        onChange={(e) => {
                          const updated = { ...editingWorkout };
                          if (!updated.exercises[i].done) updated.exercises[i].done = Array(ex.sets).fill(false);
                          updated.exercises[i].done[j] = e.target.checked;
                          setEditingWorkout(updated);
                        }}
                        className="w-5 h-5"
                      />
                      <span className="text-white text-sm w-12">Set {j + 1}</span>
                      <input
                        type="number"
                        placeholder="Weight"
                        value={ex.weights?.[j] || ''}
                        onChange={(e) => {
                          const updated = { ...editingWorkout };
                          if (!updated.exercises[i].weights) updated.exercises[i].weights = Array(ex.sets).fill('');
                          updated.exercises[i].weights[j] = e.target.value;
                          setEditingWorkout(updated);
                        }}
                        className="w-20 px-2 py-1 bg-slate-600 text-white rounded text-sm"
                      />
                      <span className="text-gray-300 text-xs">lbs √ó</span>
                      <input
                        type="number"
                        placeholder="Reps"
                        value={ex.reps2?.[j] || ''}
                        onChange={(e) => {
                          const updated = { ...editingWorkout };
                          if (!updated.exercises[i].reps2) updated.exercises[i].reps2 = Array(ex.sets).fill('');
                          updated.exercises[i].reps2[j] = e.target.value;
                          setEditingWorkout(updated);
                        }}
                        className="w-16 px-2 py-1 bg-slate-600 text-white rounded text-sm"
                      />
                      <span className="text-gray-300 text-xs">reps</span>
                    </div>
                  ))}
                </div>
              ))}

              <div className="flex gap-2">
                <button
                  onClick={() => {
                    const { id, ...data } = editingWorkout;
                    updateWorkoutInDb(id, data);
                    setEditingWorkout(null);
                  }}
                  className="flex-1 bg-green-600 text-white py-3 rounded font-bold hover:bg-green-700"
                >
                  üíæ Save Changes
                </button>
                <button onClick={() => setEditingWorkout(null)} className="flex-1 bg-slate-600 text-white py-3 rounded hover:bg-slate-500">
                  Cancel
                </button>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'edit' && editing) {
        return (
          <div className="min-h-screen bg-slate-900 p-4">
            <div className="max-w-4xl mx-auto bg-slate-800 rounded-lg p-6">
              <div className="flex justify-between mb-6">
                <h1 className="text-2xl font-bold text-white">Edit {editing.name}</h1>
                <button onClick={() => { setEditing(null); setEditEx(null); setShowNew(false); setView('home'); }} className="text-gray-400 text-2xl">‚úï</button>
              </div>

              {showNew && (
                <div className="bg-slate-700 rounded-lg p-4 mb-4">
                  <h3 className="text-white font-semibold mb-3">New Exercise</h3>
                  <input type="text" placeholder="Exercise name" value={newEx.name} onChange={(e) => setNewEx({ ...newEx, name: e.target.value })} className="w-full px-3 py-2 bg-slate-600 text-white rounded mb-2" />
                  <div className="flex gap-2 mb-2">
                    <input type="number" placeholder="Sets" value={newEx.sets} onChange={(e) => setNewEx({ ...newEx, sets: +e.target.value })} className="w-20 px-3 py-2 bg-slate-600 text-white rounded" />
                    <input type="number" placeholder="Reps" value={newEx.reps} onChange={(e) => setNewEx({ ...newEx, reps: +e.target.value })} className="w-20 px-3 py-2 bg-slate-600 text-white rounded" />
                  </div>
                  <textarea placeholder="Instructions (optional)" value={newEx.instructions} onChange={(e) => setNewEx({ ...newEx, instructions: e.target.value })} className="w-full px-3 py-2 bg-slate-600 text-white rounded mb-2 h-20" />
                  <input type="url" placeholder="Video URL (YouTube, Vimeo, Google Drive)" value={newEx.videoUrl} onChange={(e) => setNewEx({ ...newEx, videoUrl: e.target.value })} className="w-full px-3 py-2 bg-slate-600 text-white rounded mb-2" />
                  <div className="flex gap-2">
                    <button onClick={() => { if (newEx.name) { setEditing({ ...editing, exercises: [...editing.exercises, newEx] }); setNewEx({ name: '', sets: 3, reps: 10, instructions: '', videoUrl: '' }); setShowNew(false); } }} className="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">Add</button>
                    <button onClick={() => { setShowNew(false); setNewEx({ name: '', sets: 3, reps: 10, instructions: '', videoUrl: '' }); }} className="flex-1 bg-slate-600 text-white py-2 rounded hover:bg-slate-500">Cancel</button>
                  </div>
                </div>
              )}

              {editEx && (
                <div className="bg-slate-700 rounded-lg p-4 mb-4">
                  <h3 className="text-white font-semibold mb-3">Edit Exercise</h3>
                  <input type="text" value={editEx.name} onChange={(e) => setEditEx({ ...editEx, name: e.target.value })} className="w-full px-3 py-2 bg-slate-600 text-white rounded mb-2" />
                  <div className="flex gap-2 mb-2">
                    <input type="number" value={editEx.sets} onChange={(e) => setEditEx({ ...editEx, sets: +e.target.value })} className="w-20 px-3 py-2 bg-slate-600 text-white rounded" />
                    <input type="number" value={editEx.reps} onChange={(e) => setEditEx({ ...editEx, reps: +e.target.value })} className="w-20 px-3 py-2 bg-slate-600 text-white rounded" />
                  </div>
                  <textarea placeholder="Instructions" value={editEx.instructions || ''} onChange={(e) => setEditEx({ ...editEx, instructions: e.target.value })} className="w-full px-3 py-2 bg-slate-600 text-white rounded mb-2 h-20" />
                  <input type="url" placeholder="Video URL" value={editEx.videoUrl || ''} onChange={(e) => setEditEx({ ...editEx, videoUrl: e.target.value })} className="w-full px-3 py-2 bg-slate-600 text-white rounded mb-2" />
                  <div className="flex gap-2">
                    <button onClick={() => { const e = [...editing.exercises]; const { idx, ...ex } = editEx; e[idx] = ex; setEditing({ ...editing, exercises: e }); setEditEx(null); }} className="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">Save</button>
                    <button onClick={() => setEditEx(null)} className="flex-1 bg-slate-600 text-white py-2 rounded hover:bg-slate-500">Cancel</button>
                  </div>
                </div>
              )}

              <div className="mb-4">
                <div className="flex justify-between mb-3">
                  <h3 className="text-white font-semibold">Exercises</h3>
                  <button onClick={() => setShowNew(true)} className="bg-green-600 text-white px-3 py-1 rounded text-sm flex items-center gap-1 hover:bg-green-700"><Plus />New</button>
                </div>
                {editing.exercises.map((ex, i) => (
                  <div key={i} className="bg-slate-700 rounded p-3 mb-2">
                    <div className="flex justify-between">
                      <div className="flex-1">
                        <div className="text-white font-medium text-sm">{ex.name}</div>
                        <div className="text-gray-400 text-xs">{ex.sets} √ó {ex.reps}</div>
                        {ex.instructions && <div className="text-gray-400 text-xs mt-1">{ex.instructions.substring(0, 50)}...</div>}
                        {ex.videoUrl && <div className="text-blue-400 text-xs mt-1">üìπ Video</div>}
                      </div>
                      <div className="flex gap-2 ml-2">
                        <button onClick={() => setEditEx({ ...ex, idx: i })} className="text-blue-400 hover:text-blue-300"><Edit2 /></button>
                        <button onClick={() => setEditing({ ...editing, exercises: editing.exercises.filter((_, j) => j !== i) })} className="text-red-400 hover:text-red-300"><Trash2 /></button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              {editing.available && (
                <div className="mb-4">
                  <h3 className="text-white font-semibold mb-2">Add from Library</h3>
                  <div className="space-y-1 max-h-48 overflow-y-auto">
                    {editing.available.map((ex, i) => (
                      <button key={i} onClick={() => setEditing({ ...editing, exercises: [...editing.exercises, { ...ex}] })} className="w-full bg-slate-700 hover:bg-slate-600 rounded p-2 flex justify-between text-sm transition">
                        <span className="text-white">{ex.name}</span>
                        <span className="text-gray-400">{ex.sets}√ó{ex.reps}</span>
                      </button>
                    ))}
                  </div>
                </div>
              )}

              <div className="flex gap-2">
                <button onClick={() => { const newTemplates = { ...templates, [editing.key]: { name: editing.name, exercises: editing.exercises } }; saveTemplates(newTemplates); setEditing(null); setView('home'); }} className="flex-1 bg-green-600 text-white py-3 rounded font-semibold hover:bg-green-700">üíæ Save to Cloud</button>
                <button onClick={() => { setEditing(null); setView('home'); }} className="flex-1 bg-slate-600 text-white py-3 rounded hover:bg-slate-500">Cancel</button>
              </div>

              {!editing.isDefault && (
                <button onClick={() => { deleteTemplate(editing.key); setEditing(null); setView('home'); }} className="w-full mt-2 bg-red-600 text-white py-2 rounded hover:bg-red-700">
                  üóëÔ∏è Delete Template
                </button>
              )}
            </div>
          </div>
        );
      }

      if (view === 'createTemplate') {
        return (
          <div className="min-h-screen bg-slate-900 p-4">
            <div className="max-w-4xl mx-auto bg-slate-800 rounded-lg p-6">
              <div className="flex justify-between mb-6">
                <h1 className="text-2xl font-bold text-white">Create New Template</h1>
                <button onClick={() => { setNewTemplate({ name: '', exercises: [] }); setView('home'); }} className="text-gray-400 text-2xl">‚úï</button>
              </div>

              <div className="bg-slate-700 rounded-lg p-4 mb-4">
                <label className="text-white font-semibold block mb-2">Template Name</label>
                <input 
                  type="text" 
                  placeholder="e.g., Upper Body, Full Body, etc." 
                  value={newTemplate.name} 
                  onChange={(e) => setNewTemplate({ ...newTemplate, name: e.target.value })} 
                  className="w-full px-3 py-2 bg-slate-600 text-white rounded"
                />
              </div>

              <div className="mb-4">
                <h3 className="text-white font-semibold mb-3">Selected Exercises ({newTemplate.exercises.length})</h3>
                {newTemplate.exercises.length === 0 ? (
                  <div className="bg-slate-700 rounded p-4 text-gray-400 text-center text-sm">
                    No exercises selected. Choose from the library below.
                  </div>
                ) : (
                  <div className="space-y-2">
                    {newTemplate.exercises.map((ex, i) => (
                      <div key={i} className="bg-slate-700 rounded p-3 flex justify-between items-center">
                        <div className="flex-1">
                          <div className="text-white font-medium text-sm">{ex.name}</div>
                          <div className="text-gray-400 text-xs">{ex.sets} √ó {ex.reps}</div>
                        </div>
                        <button 
                          onClick={() => setNewTemplate({ ...newTemplate, exercises: newTemplate.exercises.filter((_, j) => j !== i) })} 
                          className="text-red-400 hover:text-red-300 ml-2"
                        >
                          <Trash2 />
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div className="mb-4">
                <h3 className="text-white font-semibold mb-2">Exercise Library</h3>
                <div className="space-y-1 max-h-96 overflow-y-auto">
                  {Object.entries(EXERCISES).map(([category, exercises]) => (
                    <div key={category}>
                      <div className="text-indigo-400 text-xs font-semibold uppercase mt-3 mb-1 px-2">
                        {category === 'bicepTricep' ? 'Bicep & Tricep' : category}
                      </div>
                      {exercises.map((ex, i) => {
                        const isSelected = newTemplate.exercises.some(e => e.name === ex.name);
                        return (
                          <button 
                            key={i} 
                            onClick={() => {
                              if (isSelected) {
                                setNewTemplate({ ...newTemplate, exercises: newTemplate.exercises.filter(e => e.name !== ex.name) });
                              } else {
                                setNewTemplate({ ...newTemplate, exercises: [...newTemplate.exercises, { ...ex }] });
                              }
                            }}
                            className={`w-full rounded p-2 flex justify-between text-sm transition ${isSelected ? 'bg-indigo-600 text-white' : 'bg-slate-700 hover:bg-slate-600 text-white'}`}
                          >
                            <span>{isSelected && '‚úì '}{ex.name}</span>
                            <span className="text-gray-400">{ex.sets}√ó{ex.reps}</span>
                          </button>
                        );
                      })}
                    </div>
                  ))}
                </div>
              </div>

              <div className="flex gap-2">
                <button 
                  onClick={() => {
                    if (!newTemplate.name.trim()) {
                      alert('Please enter a template name');
                      return;
                    }
                    if (newTemplate.exercises.length === 0) {
                      alert('Please select at least one exercise');
                      return;
                    }
                    const templateKey = newTemplate.name.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
                    const newTemplates = { 
                      ...templates, 
                      [templateKey]: { 
                        name: newTemplate.name, 
                        exercises: newTemplate.exercises,
                        isCustom: true
                      } 
                    };
                    saveTemplates(newTemplates);
                    setNewTemplate({ name: '', exercises: [] });
                    setView('home');
                  }}
                  disabled={!newTemplate.name.trim() || newTemplate.exercises.length === 0}
                  className="flex-1 bg-green-600 text-white py-3 rounded font-semibold hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed"
                >
                  üíæ Create Template
                </button>
                <button 
                  onClick={() => { 
                    setNewTemplate({ name: '', exercises: [] }); 
                    setView('home'); 
                  }} 
                  className="flex-1 bg-slate-600 text-white py-3 rounded hover:bg-slate-500"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'workout' && workout) {
        const vid = video ? getVideoId(video) : null;
        const workoutDuration = () => {
          const start = new Date(workout.start);
          const now = new Date();
          const diffMs = now - start;
          const diffMins = Math.floor(diffMs / 60000);
          const diffSecs = Math.floor((diffMs % 60000) / 1000);
          return `${diffMins}:${diffSecs.toString().padStart(2, '0')}`;
        };
        
        return (
          <div className="min-h-screen bg-slate-900 p-4">
            {video && (
              <div className="fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center p-4" onClick={() => setVideo(null)}>
                <div className={`${videoOrientation === 'portrait' ? 'w-full max-w-md' : 'w-full max-w-4xl'}`} onClick={(e) => e.stopPropagation()}>
                  <div className="bg-slate-800 rounded-lg p-4">
                    <div className="flex justify-between items-center mb-3">
                      <div className="text-white font-semibold">Video Tutorial</div>
                      <div className="flex items-center gap-3">
                        <button
                          onClick={() => setVideoOrientation(videoOrientation === 'portrait' ? 'landscape' : 'portrait')}
                          className="bg-slate-600 text-white px-3 py-1 rounded text-sm hover:bg-slate-500"
                        >
                          {videoOrientation === 'portrait' ? 'üì± Portrait' : 'üñ•Ô∏è Landscape'}
                        </button>
                        <button onClick={() => setVideo(null)} className="text-white text-2xl hover:text-gray-300">‚úï</button>
                      </div>
                    </div>
                    
                    {vid ? (
                      <div className="relative w-full bg-black rounded-lg overflow-hidden" style={{ paddingBottom: videoOrientation === 'portrait' ? '177.78%' : '56.25%' }}>
                        {vid.type === 'youtube' && <iframe key={vid.id} src={`https://www.youtube.com/embed/${vid.id}${vid.params}`} className="absolute inset-0 w-full h-full" style={{ border: 'none' }} allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen={true} title="Video" />}
                        {vid.type === 'vimeo' && <iframe key={vid.id} src={`https://player.vimeo.com/video/${vid.id}`} className="absolute inset-0 w-full h-full" style={{ border: 'none' }} allow="autoplay; fullscreen; picture-in-picture" allowFullScreen={true} title="Video" />}
                        {vid.type === 'drive' && <iframe key={vid.id} src={`https://drive.google.com/file/d/${vid.id}/preview`} className="absolute inset-0 w-full h-full" style={{ border: 'none' }} allow="autoplay" allowFullScreen={true} title="Video" />}
                      </div>
                    ) : (
                      <div className="bg-slate-700 rounded-lg p-8 text-center text-white">Could not load video</div>
                    )}
                    
                    <div className="mt-2 text-xs text-gray-400 text-center">
                      Click the button above to switch between portrait and landscape mode
                    </div>
                  </div>
                </div>
              </div>
            )}

            {showAddExercise && (
              <div className="fixed inset-0 bg-black bg-opacity-75 z-40 flex items-center justify-center p-4" onClick={() => setShowAddExercise(false)}>
                <div className="bg-slate-800 rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-bold text-white">Add Exercise to Workout</h2>
                    <button onClick={() => setShowAddExercise(false)} className="text-gray-400 text-2xl">‚úï</button>
                  </div>
                  
                  <div className="space-y-1">
                    {Object.entries(EXERCISES).map(([category, exercises]) => (
                      <div key={category}>
                        <div className="text-indigo-400 text-xs font-semibold uppercase mt-3 mb-1 px-2">
                          {category === 'bicepTricep' ? 'Bicep & Tricep' : category}
                        </div>
                        {exercises.map((ex, i) => (
                          <button 
                            key={i} 
                            onClick={() => addExerciseToWorkout(ex)}
                            className="w-full bg-slate-700 hover:bg-slate-600 rounded p-3 flex justify-between text-sm transition"
                          >
                            <span className="text-white">{ex.name}</span>
                            <span className="text-gray-400">{ex.sets}√ó{ex.reps}</span>
                          </button>
                        ))}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {editingExerciseInWorkout !== null && (
              <div className="fixed inset-0 bg-black bg-opacity-75 z-40 flex items-center justify-center p-4" onClick={() => setEditingExerciseInWorkout(null)}>
                <div className="bg-slate-800 rounded-lg p-6 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
                  <h2 className="text-xl font-bold text-white mb-4">Edit Exercise Sets</h2>
                  <div className="bg-slate-700 rounded p-4 mb-4">
                    <div className="text-white font-semibold mb-2">{workout.exercises[editingExerciseInWorkout].name}</div>
                    <div className="text-gray-400 text-sm mb-3">Current sets: {workout.exercises[editingExerciseInWorkout].sets}</div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => {
                          addSetToExercise(editingExerciseInWorkout);
                        }}
                        className="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700 flex items-center justify-center gap-2"
                      >
                        <Plus /> Add Set
                      </button>
                      <button
                        onClick={() => {
                          removeSetFromExercise(editingExerciseInWorkout);
                        }}
                        className="flex-1 bg-red-600 text-white py-2 rounded hover:bg-red-700 flex items-center justify-center gap-2"
                      >
                        <Minus /> Remove Set
                      </button>
                    </div>
                  </div>
                  <button
                    onClick={() => setEditingExerciseInWorkout(null)}
                    className="w-full bg-slate-600 text-white py-2 rounded hover:bg-slate-500"
                  >
                    Close
                  </button>
                </div>
              </div>
            )}

            <div className="max-w-4xl mx-auto bg-slate-800 rounded-lg p-6">
              <div className="flex justify-between mb-4">
                <div>
                  <h1 className="text-2xl font-bold text-white">{workout.name}</h1>
                  <div className="text-sm text-gray-400 mt-1">
                    Duration: <span className="text-green-400 font-semibold">{workoutDuration()}</span>
                    {resumingWorkout && <span className="ml-2 text-yellow-400">üîÑ Resumed</span>}
                  </div>
                </div>
                <div className="flex gap-2">
                  <button onClick={() => setShowTimeEdit(!showTimeEdit)} className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                    ‚è±Ô∏è Edit Time
                  </button>
                  <button onClick={() => { setWorkout(null); setResumingWorkout(false); setView('home'); }} className="text-gray-400 hover:text-white text-2xl">‚úï</button>
                </div>
              </div>

              {showTimeEdit && (
                <div className="bg-slate-700 rounded-lg p-4 mb-4">
                  <h3 className="text-white font-semibold mb-3">Override Workout Times</h3>
                  <div className="space-y-3">
                    <div>
                      <label className="text-gray-300 text-sm block mb-1">Start Time</label>
                      <input
                        type="datetime-local"
                        value={new Date(workout.start).toISOString().slice(0, 16)}
                        onChange={(e) => setWorkout({ ...workout, start: new Date(e.target.value).toISOString() })}
                        className="w-full px-3 py-2 bg-slate-600 text-white rounded"
                      />
                    </div>
                    <div className="text-gray-400 text-xs">
                      Current duration: {workoutDuration()}
                    </div>
                  </div>
                </div>
              )}

              <div className="bg-slate-700 rounded-lg p-4 mb-4">
                <h3 className="text-white font-semibold mb-2 flex items-center gap-2"><Clock />Rest Timer</h3>
                <div className="flex items-center gap-2 mb-2">
                  <input type="number" value={timer.time} onChange={(e) => setTimer({ ...timer, time: +e.target.value })} disabled={timer.active} className="w-20 px-2 py-1 bg-slate-600 text-white rounded" />
                  <span className="text-gray-300 text-sm">seconds</span>
                  <button onClick={() => playSound('ding')} className="bg-yellow-600 text-white px-3 py-1 rounded text-xs hover:bg-yellow-700">
                    üîî Test Sound
                  </button>
                </div>
                <div className="text-4xl font-bold text-white text-center mb-2">{Math.floor(timer.left / 60)}:{(timer.left % 60).toString().padStart(2, '0')}</div>
                <div className="flex gap-2">
                  <button onClick={() => timer.active ? setTimer({ ...timer, active: false }) : setTimer({ ...timer, left: timer.time, active: true })} className="flex-1 bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">{timer.active ? 'Pause' : 'Start'}</button>
                  <button onClick={() => setTimer({ ...timer, left: timer.time, active: false })} className="bg-slate-600 text-white px-3 py-2 rounded hover:bg-slate-500"><RotateCcw /></button>
                </div>
              </div>

              <div className="mb-4">
                <button
                  onClick={() => setShowAddExercise(true)}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 hover:from-purple-700 hover:to-pink-700"
                >
                  <Plus /> Add Exercise to Workout
                </button>
              </div>

             {workout.exercises.map((ex, i) => {
  const workoutHistory = getLastWorkouts(ex.name, 5);
  const trend = getTrendForExercise(ex.name);
  const currentPR = personalRecords[ex.name];
  
  return (
    <div key={i} className="bg-slate-700 rounded-lg p-4 mb-3">
      <div className="flex justify-between items-start mb-2">
        <div className="flex items-center gap-2">
          <h3 className="text-white font-semibold">{ex.name}</h3>
          {trend === 'up' && <TrendingUp className="w-4 h-4 text-green-400" title="Improving!" />}
          {trend === 'down' && <TrendingDown className="w-4 h-4 text-red-400" title="Regressing" />}
          {trend === 'neutral' && <Minus2 className="w-4 h-4 text-gray-400" title="Plateau" />}
          {currentPR && <Award className="w-4 h-4 text-yellow-400" title="You have a PR for this!" />}
        </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => setEditingExerciseInWorkout(i)}
                          className="text-blue-400 hover:text-blue-300 text-xs px-2 py-1 bg-slate-600 rounded"
                          title="Edit sets"
                        >
                          {ex.sets} sets
                        </button>
                        <button
                          onClick={() => removeExerciseFromWorkout(i)}
                          className="text-red-400 hover:text-red-300"
                          title="Remove exercise"
                        >
                          <Trash2 />
                        </button>
                      </div>
                    </div>
                    
                    {workoutHistory.length > 0 && (
  <div className="bg-blue-900 bg-opacity-50 border border-blue-500 rounded p-3 mb-3">
    <div className="text-blue-300 font-semibold text-xs mb-2 flex items-center justify-between">
      <span>üìä Last {workoutHistory.length} Workout{workoutHistory.length > 1 ? 's' : ''}:</span>
      {trend === 'up' && <span className="text-green-400">‚Üë IMPROVING</span>}
      {trend === 'down' && <span className="text-red-400">‚Üì REGRESSING</span>}
      {trend === 'neutral' && <span className="text-gray-400">‚Üí PLATEAU</span>}
    </div>
    <div className="space-y-1">
      {workoutHistory.map((h, idx) => (
        <div key={idx} className="text-blue-200 text-xs">
          <span className="font-semibold">{new Date(h.date).toLocaleDateString()}</span>
          <span className="text-blue-300"> ‚Ä¢ </span>
          {h.exercise.weights.map((w, i) => w && h.exercise.done[i] ? (
            <span key={i} className="mr-2">
              {w} lbs √ó {h.exercise.reps2?.[i] || h.exercise.reps}
            </span>
          ) : null)}
        </div>
      ))}
    </div>
    {currentPR && (
      <div className="mt-2 pt-2 border-t border-blue-400">
        <div className="text-yellow-300 font-bold text-xs">
          üèÜ Your PR: {currentPR.weight} lbs √ó {currentPR.reps} 
          <span className="text-yellow-200"> (Est. 1RM: {currentPR.estimated1RM.toFixed(1)} lbs)</span>
        </div>
      </div>
    )}
  </div>
)}
                    
                    {ex.instructions && (
                      <div className="bg-slate-600 rounded p-3 mb-2">
                        <div className="text-yellow-400 text-xs font-semibold mb-1">üìù INSTRUCTIONS</div>
                        <div className="text-gray-200 text-sm">{ex.instructions}</div>
                      </div>
                    )}
                    {ex.videoUrl && (
                      <button onClick={() => setVideo(ex.videoUrl)} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded mb-3 text-sm font-semibold flex items-center gap-2">
                        ‚ñ∂Ô∏è Watch Video
                      </button>
                    )}
                    {Array.from({ length: ex.sets }).map((_, j) => (
                      <div key={j} className="flex items-center gap-2 mb-2 flex-wrap">
                        <button onClick={() => { 
                          const w = { ...workout }; 
                          const wasCompleted = w.exercises[i].done[j];
                          w.exercises[i].done[j] = !wasCompleted; 
                          setWorkout(w); 
                          if (!wasCompleted) {
                            playSound('ding');
                            setTimer({ ...timer, left: timer.time, active: true });
                          }
                        }} className={`w-9 h-9 rounded flex items-center justify-center font-bold border-2 ${ex.done[j] ? 'bg-green-600 border-green-600 text-white' : 'bg-slate-600 border-slate-500 text-gray-400'}`}>
                          {ex.done[j] ? '‚úì' : ''}
                        </button>
                        <span className="text-white text-sm w-12">Set {j + 1}</span>
                        <input type="number" placeholder="Wt" value={ex.weights[j]} onChange={(e) => { const w = { ...workout }; w.exercises[i].weights[j] = e.target.value; setWorkout(w); }} className="w-16 px-2 py-1 bg-slate-600 text-white rounded text-sm" />
                        <span className="text-gray-300 text-xs">lbs √ó</span>
                        <input type="number" placeholder={ex.reps} value={ex.reps2[j]} onChange={(e) => { const w = { ...workout }; w.exercises[i].reps2[j] = e.target.value; setWorkout(w); }} className="w-14 px-2 py-1 bg-slate-600 text-white rounded text-sm" />
                        <span className="text-gray-300 text-xs">reps</span>
                      </div>
                    ))}
                  </div>
                );
              })}

              <button onClick={() => { 
                const completedWorkout = { ...workout, end: new Date().toISOString(), inProgress: false, completed: true };
                if (workout.resumedFrom) {
                  updateWorkoutInDb(workout.resumedFrom, completedWorkout);
                } else {
                  saveWorkoutToDb(completedWorkout);
                }
                setWorkout(null); 
                setResumingWorkout(false); 
                setView('home'); 
              }} className="w-full bg-green-600 text-white py-3 rounded font-bold flex items-center justify-center gap-2 hover:bg-green-700">
                <Save />‚úÖ Complete Workout
              </button>
              
              <button onClick={async () => { 
                const workoutId = workout.resumedFrom || await saveWorkoutProgress({ ...workout, end: new Date().toISOString() }); 
                setWorkout(null); 
                setResumingWorkout(false); 
                setView('home'); 
              }} className="w-full mt-2 bg-yellow-600 text-white py-2 rounded font-semibold flex items-center justify-center gap-2 hover:bg-yellow-700">
                üíæ Save Progress & Exit
              </button>
            </div>
          </div>
        );
      }

      
const stats = {
  totalWorkouts: workouts.filter(w => w.completed).length,
  totalSets: workouts.filter(w => w.completed).reduce((s, w) => s + w.exercises.reduce((t, e) => t + e.done.filter(Boolean).length, 0), 0),
  avgPerWeek: (workouts.filter(w => w.completed).length / 13).toFixed(1),
  totalPRs: Object.keys(personalRecords).length
};
      const inProgressWorkouts = workouts.filter(w => w.inProgress && !w.completed);
      const completedWorkouts = workouts.filter(w => w.completed);

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div className="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <div className="flex items-center justify-between mb-6 flex-wrap gap-3">
              <div className="flex items-center gap-3">
                <Dumbbell className="w-8 h-8 text-indigo-600" />
                <h1 className="text-2xl md:text-3xl font-bold text-gray-800">90-Day Tracker</h1>
              </div>
              <div className="flex items-center gap-3">
                <span className="text-sm text-gray-600">{user.email}</span>
                <button onClick={handleLogout} className="text-red-600 hover:text-red-700" title="Logout">
                  <LogOut />
                </button>
              </div>
            </div>

            <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6 text-sm">
              ‚òÅÔ∏è All data synced to cloud ‚Ä¢ Accessible on all your devices
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              <div className="bg-indigo-500 rounded-lg p-4 text-white">
                <div className="flex items-center gap-2 mb-1"><Calendar /><span className="text-sm">Completed Workouts</span></div>
                <div className="text-3xl font-bold">{stats.totalWorkouts}</div>
              </div>
              <div className="bg-purple-500 rounded-lg p-4 text-white">
                <div className="flex items-center gap-2 mb-1"><TrendingUp /><span className="text-sm">Total Sets</span></div>
                <div className="text-3xl font-bold">{stats.totalSets}</div>
              </div>
              <div className="bg-pink-500 rounded-lg p-4 text-white">
                <div className="flex items-center gap-2 mb-1"><Clock /><span className="text-sm">Avg/Week</span></div>
                <div className="text-3xl font-bold">{stats.avgPerWeek}</div>
              </div>
			  <div className="bg-yellow-500 rounded-lg p-4 text-white">
				<div className="flex items-center gap-2 mb-1"><Award /><span className="text-sm">Personal Records</span></div>
				<div className="text-3xl font-bold">{stats.totalPRs}</div>
			</div>
            </div>

            <div className="mb-6">
              <button onClick={() => setView('progress')} className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2 hover:from-indigo-700 hover:to-purple-700">
                <BarChart />View Progress Dashboard
              </button>
            </div>

            <h2 className="text-2xl font-bold mb-4">Templates</h2>
            <div className="mb-4">
              <button 
                onClick={() => setView('createTemplate')} 
                className="w-full bg-gradient-to-r from-green-500 to-teal-500 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 hover:from-green-600 hover:to-teal-600"
              >
                <Plus />Create New Template
              </button>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              {Object.entries(templates).map(([k, t]) => (
                <div key={k} className="bg-indigo-50 border-2 border-indigo-200 rounded-lg p-4">
                  <div className="flex items-center justify-between mb-1">
                    <h3 className="text-lg font-bold">{t.name}</h3>
                    {t.isCustom && <span className="text-xs bg-teal-500 text-white px-2 py-1 rounded">CUSTOM</span>}
                  </div>
                  <div className="text-sm text-gray-600 mb-3">{t.exercises.length} exercises</div>
                  <div className="flex gap-2">
                    <button onClick={() => { setWorkout({ name: t.name, start: new Date().toISOString(), exercises: t.exercises.map(e => ({ ...e, done: Array(e.sets).fill(false), weights: Array(e.sets).fill(''), reps2: Array(e.sets).fill('') })) }); setView('workout'); }} className="flex-1 bg-indigo-600 text-white py-2 rounded flex items-center justify-center gap-1 hover:bg-indigo-700"><Play />Start</button>
                    <button onClick={() => { 
                      const availableExercises = t.isCustom ? getAllExercises() : (EXERCISES[k] || getAllExercises());
                      setEditing({ key: k, ...t, available: availableExercises, isDefault: !t.isCustom }); 
                      setView('edit'); 
                    }} className="bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700"><Edit2 /></button>
                  </div>
                </div>
              ))}
            </div>

            {inProgressWorkouts.length > 0 && (
              <>
                <h2 className="text-2xl font-bold mb-4 text-orange-600">‚ö° In Progress</h2>
                <div className="space-y-2 mb-6">
                  {inProgressWorkouts.map((w) => {
                    const duration = w.end && w.start ? Math.floor((new Date(w.end) - new Date(w.start)) / 60000) : null;
                    
                    return (
                      <div key={w.id} className="bg-yellow-100 border-2 border-yellow-400 rounded-lg p-4 flex justify-between items-center hover:shadow-md transition">
                        <div className="flex-1">
                          <div className="font-bold text-gray-800 flex items-center gap-2">
                            {w.name}
                            <span className="text-xs bg-yellow-500 text-white px-2 py-1 rounded">IN PROGRESS</span>
                          </div>
                          <div className="text-sm text-gray-600">
                            {new Date(w.start).toLocaleDateString()} ‚Ä¢ {w.exercises.reduce((s, e) => s + e.done.filter(Boolean).length, 0)} sets completed
                            {duration && <span className="ml-2">‚Ä¢ {duration} min</span>}
                          </div>
                        </div>
                        <div className="flex gap-2">
                          <button 
                            onClick={() => resumeWorkout(w)} 
                            className="bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700 flex items-center gap-1"
                            title="Resume this workout"
                          >
                            <Play />Resume
                          </button>
                          <button onClick={() => setEditingWorkout(w)} className="text-blue-600 hover:text-blue-700" title="Edit">
                            <Edit2 />
                          </button>
                          <button onClick={() => deleteWorkout(w.id)} className="text-red-500 hover:text-red-700" title="Delete">
                            <Trash2 />
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </>
            )}

            <h2 className="text-2xl font-bold mb-4">Completed Workouts (Last 90 Days)</h2>
            {completedWorkouts.length === 0 ? (
              <div className="text-center py-8 text-gray-500">
                <Dumbbell className="w-12 h-12 mx-auto mb-2 opacity-50" />
                <p>No completed workouts yet. Start and complete one above!</p>
              </div>
            ) : (
              <div className="space-y-2">
                {completedWorkouts.slice(0, 20).map((w) => {
                  const duration = w.end && w.start ? Math.floor((new Date(w.end) - new Date(w.start)) / 60000) : null;
                  
                  return (
                    <div key={w.id} className="bg-gray-50 rounded-lg p-4 flex justify-between items-center hover:shadow-md transition">
                      <div className="flex-1">
                        <div className="font-bold text-gray-800 flex items-center gap-2">
                          {w.name}
                          <span className="text-xs bg-green-600 text-white px-2 py-1 rounded">‚úì COMPLETED</span>
                        </div>
                        <div className="text-sm text-gray-600">
                          {new Date(w.start).toLocaleDateString()} ‚Ä¢ {w.exercises.reduce((s, e) => s + e.done.filter(Boolean).length, 0)} sets
                          {duration && <span className="ml-2">‚Ä¢ {duration} min</span>}
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => setEditingWorkout(w)} className="text-blue-600 hover:text-blue-700" title="Edit">
                          <Edit2 />
                        </button>
                        <button onClick={() => deleteWorkout(w.id)} className="text-red-500 hover:text-red-700" title="Delete">
                          <Trash2 />
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
